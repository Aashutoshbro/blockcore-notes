<app-profile-header></app-profile-header>

@if (layout == 5) {
  <app-content-music></app-content-music>
  <!-- <div *ngIf="rootEvents$ | withStatus | async as items" class="feed-page">
    <ng-template [ngIf]="items.value && items.value.length > 0">
      <app-content-music [events]="items.value"> </app-content-music>
    </ng-template>
    <ng-template [ngIf]="items.loading"><mat-spinner class="loading"></mat-spinner></ng-template>
    <ng-template [ngIf]="items.error">Error {{ items.error }}</ng-template>
  </div> -->
}

@if (layout == 6) {
  <app-content-podcast></app-content-podcast>
  <!-- <div *ngIf="rootEvents$ | withStatus | async as items" class="feed-page">
    <ng-template [ngIf]="items.value && items.value.length > 0">
      <app-content-music [events]="items.value"> </app-content-music>
    </ng-template>
    <ng-template [ngIf]="items.loading"><mat-spinner class="loading"></mat-spinner></ng-template>
    <ng-template [ngIf]="items.error">Error {{ items.error }}</ng-template>
  </div> -->
}

@if (layout == 2) {
  <!-- <div *ngIf="rootEvents$ | withStatus | async as items" class="feed-page">
    <ng-template [ngIf]="items.value && items.value.length > 0">
      <app-content-photos [events]="items.value"> </app-content-photos>
    </ng-template>
    <ng-template [ngIf]="items.loading"><mat-spinner class="loading"></mat-spinner></ng-template>
    <ng-template [ngIf]="items.error">Error {{ items.error }}</ng-template>
  </div> -->
}

<!-- <div *ngIf="rootEvents$ | withStatus | async as items">
  <div *ngFor="let event of items.value; trackBy: trackByFn">{{event.id}}</div>
</div> -->

@if (layout == 3) {
  <mat-tab-group [selectedIndex]="tabIndex" (selectedTabChange)="onTabChanged($event)">
    <mat-tab label="Notes">
      @let (items = ui.rootEventsView$ | withStatus) {
        <div class="feed-page">
          @if (items.value) {
            <!-- <div class="page" *ngIf="items.value.length === 0">
              <h3 class="marginless">Looks a bit lonely here? This is probably because it's been a while since @{{ ui.profile?.name }} has posted.</h3>
            </div> -->

            @if (!isFollowing) {
              <div class="dimmed">{{ 'User.YouMustFollowTheUserToAutomaticallyRenderPhotos' | translate }}</div>
              <br />
            }

            <div class="image-grid" [photoGalleryGroup]="{ arrowEl: true, indexIndicatorSep: ' - ' }">
              @for (event of items.value; track trackByFn(event)) {
                @if (parseToImage(event) as images) {
                  @if (isFollowing) {
                    @for (image of images; track image) {
                      <div class="image-grid-item" [photoGallery]="image"><img loading="lazy" [src]="image" /></div>
                    }
                  } @else {
                    @for (image of images; track image) {
                      <div class="image-grid-item">{{ image }}</div>
                    }
                  }
                }
              }
            </div>

            <!-- <app-content-photos [events]="items.value"></app-content-photos> -->

            <!-- <mat-card class="events clickable" (click)="navigation.openEvent($event, event)" *ngFor="let event of items.value; trackBy: trackByFn">
              <div class="events-header">
                <app-event-header [pubkey]="event.pubkey"><span class="event-date clickable">{{ event.created_at | ago }}</span> <app-directory-icon [pubkey]="event.pubkey"></app-directory-icon></app-event-header>
                <app-event-actions [event]="event" [pubkey]="event.pubkey"></app-event-actions>
              </div>
              <app-content [event]="event"></app-content>
            </mat-card> -->
          }
          @if (items.loading) {
            <mat-spinner class="loading"></mat-spinner>
          }
          @if (items.error) {
            {{'User.Error' | translate }} {{ items.error }}
          }
        </div>
      }

      <div class="show-more centered">
        @if (!ui.viewCounts.rootEventsViewCountExhausted) {
          <button mat-button (click)="showMore()">{{ 'User.ShowMore' | translate }}</button>
        }
        @if (ui.viewCounts.replyEventsViewCountExhausted) {
          <button mat-button (click)="showMore()">{{ 'User.LoadingMoreEvents' | translate }}</button>
        }
      </div>
    </mat-tab>
    <mat-tab label="Replies">
      @let (items = ui.replyEventsView$ | withStatus) {
        <div class="feed-page">
          @if (items.value) {
            <!-- <div class="page" *ngIf="items.value.length === 0">
              <h3 class="marginless">Looks a bit lonely here? This is probably because it's been a while since @{{ ui.profile?.name }} has posted or maybe they have not posted anything on your current relays.</h3>
            </div> -->

            @for (event of items.value; track trackByFn(event)) {
              <mat-card class="events clickable" (click)="navigation.openEvent($event, event)">
                <div class="events-header">
                  <app-event-header [pubkey]="event.pubkey"><span class="event-date clickable">{{ event.created_at | ago }}</span> <app-directory-icon [pubkey]="event.pubkey"></app-directory-icon></app-event-header>
                  <app-event-actions [event]="event" [pubkey]="event.pubkey"></app-event-actions>
                </div>
                <app-content [event]="event"></app-content>
              </mat-card>
            }
          }
          @if (items.loading) {
            <mat-spinner class="loading"></mat-spinner>
          }
          @if (items.error) {
            {{'User.Error' | translate }} {{ items.error }}
          }
        </div>
      }

      <div class="show-more centered">
        @if (!ui.viewCounts.replyEventsViewCountExhausted) {
          <button mat-button (click)="showMore()">{{ 'User.ShowMore' | translate }}</button>
        }
        @if (ui.viewCounts.replyEventsViewCountExhausted) {
          <button mat-button (click)="showMore()">{{ 'User.LoadingMoreEvents' | translate }}</button>
        }
      </div>
    </mat-tab>
  </mat-tab-group>
}

@if (layout == 1) {
  <mat-tab-group [selectedIndex]="tabIndex" (selectedTabChange)="onTabChanged($event)">
    <mat-tab label="Notes">
      @let (items = ui.rootEventsView$ | withStatus) {
        <div class="feed-page">
          @if (items.value) {
            <!-- <div class="page" *ngIf="items.value.length === 0">
              <h3 class="marginless">Looks a bit lonely here? This is probably because it's been a while since @{{ ui.profile?.name }} has posted.</h3>
            </div> -->

            @for (event of items.value; track trackByFn(event)) {
              <mat-card class="events clickable" (click)="navigation.openEvent($event, event)">
                <div class="events-header">
                  <app-event-header [pubkey]="event.pubkey"><span class="event-date clickable">{{ event.created_at | ago }}</span> <app-directory-icon [pubkey]="event.pubkey"></app-directory-icon></app-event-header>
                  <app-event-actions [event]="event" [pubkey]="event.pubkey"></app-event-actions>
                </div>
                <app-content [event]="event"></app-content>
              </mat-card>
            }
          }
          @if (items.loading) {
            <mat-spinner class="loading"></mat-spinner>
          }
          @if (items.error) {
            {{'User.Error' | translate }} {{ items.error }}
          }
        </div>
      }

      <div class="show-more centered">
        @if (!ui.viewCounts.rootEventsViewCountExhausted) {
          <button mat-button (click)="showMore()">{{ 'User.ShowMore' | translate }}</button>
        }
        @if (ui.viewCounts.replyEventsViewCountExhausted) {
          <button mat-button (click)="showMore()">{{ 'User.LoadingMoreEvents' | translate }}</button>
        }
      </div>
    </mat-tab>
    <mat-tab label="Replies">
      @let (items = ui.replyEventsView$ | withStatus) {
        <div class="feed-page">
          @if (items.value) {
            <!-- <div class="page" *ngIf="items.value.length === 0">
              <h3 class="marginless">Looks a bit lonely here? This is probably because it's been a while since @{{ ui.profile?.name }} has posted or maybe they have not posted anything on your current relays.</h3>
            </div> -->

            @for (event of items.value; track trackByFn(event)) {
              <mat-card class="events clickable" (click)="navigation.openEvent($event, event)">
                <div class="events-header">
                  <app-event-header [pubkey]="event.pubkey"><span class="event-date clickable">{{ event.created_at | ago }}</span> <app-directory-icon [pubkey]="event.pubkey"></app-directory-icon></app-event-header>
                  <app-event-actions [event]="event" [pubkey]="event.pubkey"></app-event-actions>
                </div>
                <app-content [event]="event"></app-content>
              </mat-card>
            }
          }
          @if (items.loading) {
            <mat-spinner class="loading"></mat-spinner>
          }
          @if (items.error) {
            {{'User.Error' | translate }} {{ items.error }}
          }
        </div>
      }

      <div class="show-more centered">
        @if (!ui.viewCounts.replyEventsViewCountExhausted) {
          <button mat-button (click)="showMore()">{{ 'User.ShowMore' | translate }}</button>
        }
        @if (ui.viewCounts.replyEventsViewCountExhausted) {
          <button mat-button (click)="showMore()">{{ 'User.LoadingMoreEvents' | translate }}</button>
        }
      </div>
    </mat-tab>
  </mat-tab-group>
}
